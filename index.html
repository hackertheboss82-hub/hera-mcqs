<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MCQ Test System</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body { font-family: Arial; background:#f5f5f5; margin:20px }
.card { background:#fff; padding:20px; margin-bottom:20px; border-radius:6px }
button { padding:10px 15px; margin:5px }
input, textarea { width:100%; padding:8px; margin:5px 0 }
.hidden { display:none }
.option { margin:8px 0 }
.timer { font-weight:bold; color:red }
</style>
</head>

<body>

<h2>Login As</h2>
<button onclick="showStudent()">Student</button>
<button onclick="showTeacher()">Teacher</button>

<!-- STUDENT PANEL -->
<div id="studentPanel" class="card hidden">
<h3>Student Panel</h3>
<input id="studentName" placeholder="Enter your name">
<button onclick="loadTests()">Load Tests</button>
<div id="testList"></div>
<div id="examArea"></div>
</div>

<!-- TEACHER PANEL -->
<div id="teacherLogin" class="card hidden">
<h3>Teacher Login</h3>
<input type="password" id="teacherPin" placeholder="Enter PIN">
<button onclick="teacherLogin()">Login</button>
</div>

<div id="teacherPanel" class="card hidden">
<h3>Teacher Panel</h3>

<input id="testTitle" placeholder="Test Title">
<input id="testTime" placeholder="Time (minutes)">
<textarea id="questionInput" rows="8"
placeholder="Question | A | B | C | D | correctIndex"></textarea>
<button onclick="createTest()">Create Test</button>

<h4>All Tests</h4>
<div id="teacherTests"></div>

<h4>Student Attempts</h4>
<div id="attempts"></div>
</div>

<script>
// ðŸ”¥ FIREBASE CONFIG (YOURS)
const firebaseConfig = {
  apiKey: "AIzaSyBQ2-dTUTPwhf7WqceEwXpk9CtPksR1xCk",
  authDomain: "hera-mcqs-55022.firebaseapp.com",
  databaseURL: "https://hera-mcqs-55022-default-rtdb.firebaseio.com",
  projectId: "hera-mcqs-55022",
  storageBucket: "hera-mcqs-55022.firebasestorage.app",
  messagingSenderId: "878791404574",
  appId: "1:878791404574:web:a0ec3ab2819423aa09120f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// UI SWITCH
function showStudent(){
  studentPanel.classList.remove("hidden");
  teacherLogin.classList.add("hidden");
  teacherPanel.classList.add("hidden");
}
function showTeacher(){
  teacherLogin.classList.remove("hidden");
  studentPanel.classList.add("hidden");
}

// TEACHER LOGIN
function teacherLogin(){
  if(teacherPin.value==="12345"){
    teacherPanel.classList.remove("hidden");
    teacherLogin.classList.add("hidden");
    loadTeacherTests();
    loadAttempts();
  } else alert("Wrong PIN");
}

// CREATE TEST
function createTest(){
  let qs=[];
  questionInput.value.trim().split("\n").forEach(l=>{
    let p=l.split("|").map(x=>x.trim());
    if(p.length===6){
      qs.push({q:p[0],o:p.slice(1,5),c:Number(p[5])});
    }
  });
  db.ref("tests").push({
    title:testTitle.value,
    time:Number(testTime.value),
    questions:qs
  });
  alert("Test Created");
  loadTeacherTests();
}

// LOAD TEACHER TESTS
function loadTeacherTests(){
  teacherTests.innerHTML="";
  db.ref("tests").once("value",s=>{
    s.forEach(t=>{
      teacherTests.innerHTML+=`
      <div>
        ${t.val().title}
        <button onclick="deleteTest('${t.key}')">Delete</button>
      </div>`;
    });
  });
}
function deleteTest(id){
  if(confirm("Delete test?")){
    db.ref("tests/"+id).remove();
    loadTeacherTests();
  }
}

// STUDENT LOAD TESTS
function loadTests(){
  testList.innerHTML="";
  db.ref("tests").once("value",s=>{
    s.forEach(t=>{
      testList.innerHTML+=`
      <button onclick="startTest('${t.key}')">${t.val().title}</button>`;
    });
  });
}

// EXAM LOGIC
let exam=[], idx=0, answers=[], timerInt, timeLeft, currentTestId;

function startTest(id){
  currentTestId=id;
  db.ref("tests/"+id).once("value",s=>{
    let q=s.val().questions;
    exam=q.sort(()=>0.5-Math.random()).slice(0,30);
    answers=[];
    idx=0;
    timeLeft=s.val().time*60;
    runTimer();
    showQuestion();
  });
}

function runTimer(){
  clearInterval(timerInt);
  timerInt=setInterval(()=>{
    timeLeft--;
    document.getElementById("timer")?.remove();
    examArea.insertAdjacentHTML("afterbegin",
      `<div id="timer" class="timer">Time: ${timeLeft}s</div>`);
    if(timeLeft<=0) submitTest();
  },1000);
}

function showQuestion(){
  let q=exam[idx];
  examArea.innerHTML=`
  <div class="timer" id="timer"></div>
  <h4>Q ${idx+1}/30</h4>
  <p>${q.q}</p>
  ${q.o.map((o,i)=>`
    <div class="option">
    <input type="radio" name="opt" value="${i}"
    ${answers[idx]==i?"checked":""}
    onclick="answers[${idx}]=${i}">
    ${o}
    </div>`).join("")}
  <button onclick="prevQ()">Previous</button>
  <button onclick="nextQ()">Next</button>
  <button onclick="submitTest()">Submit</button>`;
}

function nextQ(){ if(idx<29){ idx++; showQuestion(); } }
function prevQ(){ if(idx>0){ idx--; showQuestion(); } }

function submitTest(){
  clearInterval(timerInt);
  let score=0;
  exam.forEach((q,i)=>{ if(answers[i]==q.c) score++; });

  db.ref("attempts").push({
    student:studentName.value,
    test:currentTestId,
    score:score,
    time:new Date().toLocaleString()
  });

  examArea.innerHTML=`<h3>Score: ${score}/30</h3>`;
}

// LOAD ATTEMPTS
function loadAttempts(){
  attempts.innerHTML="";
  db.ref("attempts").on("value",s=>{
    attempts.innerHTML="";
    s.forEach(a=>{
      let v=a.val();
      attempts.innerHTML+=`${v.student} : ${v.score} <br>`;
    });
  });
}
</script>

</body>
</html>
