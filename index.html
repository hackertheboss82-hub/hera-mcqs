<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Online Exam System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
.container{max-width:1000px;margin:auto;padding:15px}
.card{background:#fff;padding:15px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
h2{text-align:center}
input,textarea,button,select{width:100%;padding:10px;margin:6px 0;border-radius:5px;border:1px solid #ccc}
button{background:#2563eb;color:#fff;border:none;font-size:16px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
.timer{text-align:right;font-weight:bold}
.option{border:1px solid #ccc;padding:8px;margin:6px 0;border-radius:5px}
.option.selected{background:#2563eb;color:#fff}
.hidden{display:none}
</style>
</head>
<body>

<div class="container">

<!-- LOGIN -->
<div id="login" class="card">
<h2>ğŸ” Login</h2>
<input id="user" placeholder="Username (admin/teacher OR student)">
<input id="pass" type="password" placeholder="Password (leave empty for student)">
<button onclick="login()">Login</button>
<p><b>Admin:</b> admin / admin123<br>
<b>Teacher:</b> teacher / teacher123<br>
<b>Student:</b> Enter name only</p>
</div>

<!-- STUDENT INFO -->
<div id="studentInfo" class="card hidden">
<h2>ğŸ‘¨â€ğŸ“ Student Details</h2>
<input id="sname" placeholder="Student Name">
<input id="sroll" placeholder="Roll / ID">
<button onclick="startStudent()">Start Test</button>
</div>

<!-- TEACHER PANEL -->
<div id="teacher" class="card hidden">
<h2>ğŸ‘¨â€ğŸ« Teacher Panel</h2>

<label>Test Name</label>
<input id="testName">

<label>Duration (minutes)</label>
<input id="duration" type="number" value="30">

<label>Bulk Questions</label>
<textarea id="questions" rows="6"
placeholder="Question | opt1 | opt2 | opt3 | opt4 | correctIndex"></textarea>

<button onclick="saveTest()">Save Test</button>

<h3>ğŸ“Š Student Attempts</h3>
<table>
<thead>
<tr><th>Name</th><th>Roll</th><th>Score</th><th>Total</th><th>Date</th></tr>
</thead>
<tbody id="resultTable"></tbody>
</table>

<button onclick="exportCSV()">Export Excel</button>
<button onclick="window.print()">Export PDF</button>
<button onclick="logout()">Logout</button>
</div>

<!-- STUDENT EXAM -->
<div id="studentExam" class="card hidden">
<div class="timer" id="timer"></div>
<h2 id="qText"></h2>
<div id="opts"></div>
<button onclick="nextQ()">Next</button>
</div>

<!-- RESULT -->
<div id="result" class="card hidden">
<h2>âœ… Test Submitted</h2>
<p id="finalScore"></p>
</div>

</div>

<script>
let role="",test={},qs=[],i=0,ans=[];
let student={},timeLeft,timerInt;

function login(){
  let u=user.value,p=pass.value;
  if((u==="admin"&&p==="admin123")||(u==="teacher"&&p==="teacher123")){
    role="teacher";
    login.classList.add("hidden");
    teacher.classList.remove("hidden");
    loadResults();
  }else{
    role="student";
    login.classList.add("hidden");
    studentInfo.classList.remove("hidden");
  }
}

function logout(){location.reload()}

function saveTest(){
  let qLines=questions.value.trim().split("\n");
  let qArr=qLines.map(l=>{
    let p=l.split("|").map(x=>x.trim());
    return {q:p[0],o:p.slice(1,5),c:+p[5]}
  });
  localStorage.setItem("test",JSON.stringify({
    name:testName.value,
    duration:+duration.value,
    questions:qArr
  }));
  alert("Test saved");
}

function startStudent(){
  student={name:sname.value,roll:sroll.value};
  test=JSON.parse(localStorage.getItem("test"));
  qs=shuffle([...test.questions]);
  studentInfo.classList.add("hidden");
  studentExam.classList.remove("hidden");
  timeLeft=test.duration*60;
  timerInt=setInterval(runTimer,1000);
  showQ();
}

function runTimer(){
  let m=Math.floor(timeLeft/60),s=timeLeft%60;
  timer.innerText=`â± ${m}:${s.toString().padStart(2,"0")}`;
  if(timeLeft--<=0) finish();
}

function showQ(){
  let q=qs[i];
  qText.innerText=(i+1)+". "+q.q;
  opts.innerHTML="";
  q.o.forEach((o,idx)=>{
    let d=document.createElement("div");
    d.className="option";
    d.innerText=o;
    d.onclick=()=>{
      ans[i]=idx;
      document.querySelectorAll(".option").forEach(x=>x.classList.remove("selected"));
      d.classList.add("selected");
    }
    opts.appendChild(d);
  });
}

function nextQ(){ if(++i<qs.length) showQ(); else finish(); }

function finish(){
  clearInterval(timerInt);
  studentExam.classList.add("hidden");
  let score=0;
  qs.forEach((q,idx)=>{ if(ans[idx]===q.c) score++; });

  let results=JSON.parse(localStorage.getItem("examResults")||"[]");
  results.push({
    ...student,
    score,
    total:qs.length,
    date:new Date().toLocaleString()
  });
  localStorage.setItem("examResults",JSON.stringify(results));

  finalScore.innerText=`${student.name}, your score: ${score}/${qs.length}`;
  result.classList.remove("hidden");
}

function loadResults(){
  let results=JSON.parse(localStorage.getItem("examResults")||"[]");
  resultTable.innerHTML="";
  results.forEach(r=>{
    resultTable.innerHTML+=`<tr>
      <td>${r.name}</td><td>${r.roll}</td>
      <td>${r.score}</td><td>${r.total}</td>
      <td>${r.date}</td>
    </tr>`;
  });
}

function exportCSV(){
  let rows=JSON.parse(localStorage.getItem("examResults")||"[]");
  let csv="Name,Roll,Score,Total,Date\n";
  rows.forEach(r=>csv+=`${r.name},${r.roll},${r.score},${r.total},${r.date}\n`);
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download="results.csv";
  a.click();
}

function shuffle(a){return a.sort(()=>Math.random()-.5)}
</script>
</body>
</html>
