<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MCQ Test System</title>
<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f9;
}
.container{
    width:90%;
    margin:auto;
}
.panel{
    background:#fff;
    padding:20px;
    margin-top:20px;
    border-radius:6px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
}
button{
    padding:10px 18px;
    margin:5px;
    background:#1e73d8;
    color:white;
    border:none;
    border-radius:4px;
    cursor:pointer;
}
button:hover{background:#155cb0;}
input,select,textarea{
    width:100%;
    padding:8px;
    margin:6px 0;
}
.hidden{display:none;}
.option{
    font-size:16px;
    margin:8px 0;
}
.option input{
    transform:scale(1.4);
    margin-right:10px;
}
.palette button{
    background:#ddd;
    color:black;
}
.palette .active{
    background:#1e73d8;
    color:white;
}
.timer{
    color:red;
    font-weight:bold;
}
</style>
</head>

<body>
<div class="container">

<h2>Login As</h2>
<div id="loginBtns">
<button onclick="showStudent()">Student</button>
<button onclick="showTeacher()">Teacher</button>
</div>

<!-- STUDENT PANEL -->
<div class="panel hidden" id="studentPanel">
<h3>Student Panel</h3>

<input id="sName" placeholder="Student Name">
<input id="sRoll" placeholder="Roll No">
<select id="sClass">
<option value="">Select Class</option>
<option>JR</option>
<script>
for(let i=1;i<=10;i++){
document.write(`<option>${i}</option>`);
}
</script>
</select>

<button onclick="loadTests()">Load Tests</button>

<div id="testArea" class="hidden">
<div class="timer">Time: <span id="time"></span>s</div>
<div class="palette" id="palette"></div>
<hr>
<div id="question"></div>

<button onclick="prevQ()">Previous</button>
<button onclick="nextQ()">Next</button>
<button onclick="submitTest()">Submit</button>
</div>
</div>

<!-- TEACHER PANEL -->
<div class="panel hidden" id="teacherPanel">
<h3>Teacher Panel</h3>

<input id="tPass" placeholder="Password">
<button onclick="teacherLogin()">Login</button>

<div id="teacherArea" class="hidden">
<input id="testTitle" placeholder="Test Title">
<select id="testClass">
<option value="">Select Class</option>
<option>JR</option>
<script>
for(let i=1;i<=10;i++){
document.write(`<option>${i}</option>`);
}
</script>
</select>
<input id="testTime" placeholder="Time (minutes)">
<textarea id="questions" rows="8" placeholder="Format:
Q?
A) opt
B) opt
C) opt
D) opt
ANS:B"></textarea>

<button onclick="createTest()">Create / Update Test</button>
<div id="testList"></div>
</div>
</div>

</div>

<script>
let tests = JSON.parse(localStorage.getItem("tests")||"[]");
let currentTest, qIndex=0, answers=[], timer;

function showStudent(){
    studentPanel.classList.remove("hidden");
    teacherPanel.classList.add("hidden");
    loginBtns.classList.add("hidden");
}
function showTeacher(){
    teacherPanel.classList.remove("hidden");
    studentPanel.classList.add("hidden");
    loginBtns.classList.add("hidden");
}
function teacherLogin(){
    if(tPass.value==="12345"){
        teacherArea.classList.remove("hidden");
        loadTeacherTests();
    }else alert("Wrong password");
}
function createTest(){
    let obj={
        title:testTitle.value,
        class:testClass.value,
        time:parseInt(testTime.value)*60,
        data:questions.value
    };
    tests = tests.filter(t=>t.title!==obj.title);
    tests.push(obj);
    localStorage.setItem("tests",JSON.stringify(tests));
    alert("Saved");
    loadTeacherTests();
}
function loadTeacherTests(){
    testList.innerHTML="";
    tests.forEach(t=>{
        let b=document.createElement("button");
        b.innerText="Delete "+t.title;
        b.onclick=()=>{
            tests=tests.filter(x=>x!==t);
            localStorage.setItem("tests",JSON.stringify(tests));
            loadTeacherTests();
        }
        testList.appendChild(b);
    });
}

function loadTests(){
    currentTest = tests.find(t=>t.class===sClass.value);
    if(!currentTest){alert("No test for class");return;}
    parseQuestions();
    startTimer();
    testArea.classList.remove("hidden");
    showQ();
}

let qs=[];
function parseQuestions(){
    qs=[];
    let parts=currentTest.data.split("ANS:");
    for(let i=0;i<parts.length-1;i++){
        let block=parts[i];
        let lines=block.trim().split("\n");
        let q=lines[0];
        let opts=lines.slice(1,5);
        let ans=parts[i+1].trim()[0];
        qs.push({q,opts,ans});
    }
    answers=new Array(qs.length);
    palette.innerHTML="";
    qs.forEach((_,i)=>{
        let b=document.createElement("button");
        b.innerText=i+1;
        b.onclick=()=>{qIndex=i;showQ();}
        palette.appendChild(b);
    });
}
function showQ(){
    let q=qs[qIndex];
    question.innerHTML=`<b>${qIndex+1}. ${q.q}</b>`;
    q.opts.forEach((o,i)=>{
        let ch=String.fromCharCode(65+i);
        question.innerHTML+=`
        <div class="option">
        <input type="radio" name="opt" ${answers[qIndex]==ch?"checked":""}
        onclick="answers[${qIndex}]='${ch}'">
        ${ch}) ${o.slice(3)}
        </div>`;
    });
    [...palette.children].forEach((b,i)=>b.classList.toggle("active",i===qIndex));
}
function nextQ(){if(qIndex<qs.length-1){qIndex++;showQ();}}
function prevQ(){if(qIndex>0){qIndex--;showQ();}}

function startTimer(){
    let t=currentTest.time;
    time.innerText=t;
    clearInterval(timer);
    timer=setInterval(()=>{
        t--; time.innerText=t;
        if(t<=0){clearInterval(timer);submitTest();}
    },1000);
}
function submitTest(){
    clearInterval(timer);
    let score=0;
    qs.forEach((q,i)=>{if(answers[i]===q.ans)score++;});
    alert(`Submitted!\nScore: ${score}/${qs.length}`);
}
</script>
</body>
</html>
